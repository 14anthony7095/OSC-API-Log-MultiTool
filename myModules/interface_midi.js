var JZZ = require('jzz');

// function lerp(start, end, factor) { return start + (end - start) * factor; }

async function playNote(chan, num, vel) {
	var port = await JZZ().openMidiOut('LoopBe Internal MIDI');
	port.control(chan, num, vel)
}
exports.playNote = playNote;


var scr = [
`
0000000000000000
0000000000000000
0000001010100000
0000001000100000
0000001000100000
0000001000100000
0000001010100000
0000000000000000`,
`
0000000000000000
0000000000000000
0000000000110000
0000000000110000
0000000000110000
0000000000110000
0000000000110000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001212120000
0000000000120000
0000001212120000
0000001200000000
0000001212120000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001313130000
0000000000130000
0000000013130000
0000000000130000
0000001313130000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001400140000
0000001400140000
0000001414140000
0000000000140000
0000000000140000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001515150000
0000001500000000
0000001515150000
0000000000150000
0000001515150000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001616160000
0000001600000000
0000001616160000
0000001600160000
0000001616160000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001717170000
0000000000170000
0000000000170000
0000000000170000
0000000000170000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001818180000
0000001800180000
0000001818180000
0000001800180000
0000001818180000
0000000000000000`,
`
0000000000000000
0000000000000000
0000001919190000
0000001900190000
0000001919190000
0000000000190000
0000000000190000
0000000000000000`,
`
0000000000000000
0000000000000000
0010001516150000
0011001600140000
0012001700130000
0013001800120000
0014001910110000
0000000000000000`,
`
1014141414141410
1413111111111314
1411141515141114
1413111010111314
1011141515141110
1413111515111314
1413111515111314
1011111010111110`
]


async function sendScreen() {
	var port = await JZZ().openMidiOut('LoopBe Internal MIDI');
	scr.forEach((frame, index) => {
		setTimeout(() => {
			frame.match(/.{2}/g).forEach((num, index2, arr) => {
				// console.log(num[0], num[1])
				/*
				0 = Gray Slate
				1 = Gray Stone
				2 = White
				3 = Red
				4 = Orange
				5 = Yellow
				6 = Green
				7 = Cyan
				8 = Blue
				9 = Magenta
				*/
				parseInt(num[0]) == 1 ? port.noteOn(1, index2, parseInt(num[1])+1) : port.noteOff(1, index2, 127)
			})
		}, 1000 * index);
	})
}

exports.sendScreenDebug = sendScreenDebug
var sendScreenDebugCooldownActive = false
async function sendScreenDebug() {
	if( sendScreenDebugCooldownActive == true ){ return }
	sendScreenDebugCooldownActive = true
	setTimeout(() => { sendScreenDebugCooldownActive = false }, 30_000);
	var port = await JZZ().openMidiOut('LoopBe Internal MIDI');
	for (let index = 0; index < 64; index++) {
		setTimeout(() => {
			port.noteOn(1, index, 2+1)
		}, 100 * index);
	}
	setTimeout(() => {
		for (let index = 0; index < 64; index++) {
			setTimeout(() => {
				port.noteOff(1, index, 127)
			}, 100 * index);
		}
	}, 6500);
	setTimeout(() => { sendScreen() }, 6500 * 2);
	// parseInt(num) == 1 ?  : port.noteOff(1, index, 127)
}

// setInterval(() => {
// 	console.log('keep alive')
// }, 30000);